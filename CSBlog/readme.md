## Стажировка C#-разработчик

## Содержание

[0. Описание](readme.md#Описание-проекта)

[1. Этап 1](readme.md#Этап-1)

[2. Этап 2](readme.md#Этап-2)

[3. Этап 3](readme.md#Этап-3)

[4. Этап 4](readme.md#Этап-4) [Screenshots](./CSBlog/readme.md)

# Описание проекта

Задачей на итоговой проект будет разработка блога.
В блоге будут доступны следующие операции:

- Регистрация пользователей
- Создание статьи
- Создание и редактирование статьи
- Теги статей
- Поиск по тегам и тексту
- Комментирование статей

Блог будет разрабатываться в 4 этапа.

---

# Этап 1

---

## Шаг 1. База данных

Заранее посмотрите на необходимые нам операции в блоге и смоделируйте количество возможных бизнес-моделей нашего проекта. На текущий момент их всего четыре:

- Пользователь
- Статья
- Тег
- Комментарий

Следовательно, необходимо создать как минимум четыре таблицы в нашей базе данных. Но это как минимум. Потому что наши бизнес-модели связаны между собой, и в базе данных необходимо реализовать связь между ними.
_SQLite_ будет оптимальным вариантом для использования в качестве базы данных.

## Шаг 2. Многоуровневая архитектура, **ORM** и бизнес-модели

### 1. Создайте **ASP.NET MVC**-проект и реализуйте в нём многоуровневую архитектуру.

Например, можно использовать трехуровневую архитектуру, по которой у нас с вами уже есть неплохой практический опыт (вспоминаем нашу социальную сеть). Но если вы решите поэкспериментировать, то можно поднять с грядки «архитектуру луковицу» (_Onion Architecture_) и взять за основу этот шаблон.

### 2. Далее нам необходимо подключить **ORM**.

Entity Framework будет идеальным вариантом для быстрого старта и налаживания связей между нашими бизнес моделями. Да и структурированные запросы вида select \* from users не придется писать руками.

### 3. Переходим к реализации наших бизнес-моделей.

Для каждой бизнес-модели создаём новый класс и добавляем в него все необходимые свойства, которые мы ещё успешно создали в первом шаге, во время проектирования базы данных.

## Шаг 3. **CRUD**-операции для бизнес-моделей

На этом шаге необходимо добавить _CRUD_-операции для каждой бизнес-модели.

Например, возьмём бизнес-модель статьи. Для неё нам необходимо будет добавить в контроллер и реализовать следующие методы:

- **Create** — создание новой статьи.
- **Read** — получение всех статей.
- **Update** — редактирование статьи.
- **Delete** — удаление статьи.

Для каждой _CRUD_-операции существуют соответствующие _HTTP_-методы запроса.
Основная логика при работе с бизнес моделями должна находится в соответствующих службах.
Например, вызов _CRUD_-операций в контроллере _UserController_ будет пробрасываться в службу _UserService_. При использовании _UserService_ в _UserController_ не забываем использовать процесс `Dependency Injection` (внедрение зависимостей).

Обратите внимание на логику регистрации пользователя. При регистрации пользователь должен получать как минимум одну роль в приложении, например роль «Пользователь».

## Шаг 4. Аутентификация и авторизация пользователей

На данном шаге необходимо реализовать аутентификацию пользователей и авторизацию.

Распределите возможности **_администратора_**, **_модератора_** и **_пользователя_** в системе.

Например, администратор может удалить любого пользователя, а пользователь может редактировать только свои статьи.

У администратора есть полные права на любые операции с бизнес-моделями, у модератора — только права на операции редактирования статей и комментариев, у пользователя — только права на операции со своими созданными бизнес-моделями (статья, комментарий, тег).

Выполнить это можно при помощи клаймов.

:arrow_up: [к содержанию](readme.md#Содержание)

---

# Этап 2

---

## Шаг 1. Вёрстка основного макета **Layout**

Сайт, который выглядит довольно приятно внешне и имеет современный дизайн, вызывает только восхищение. Поэтому наш блог должен быть как минимум приятным глазу.

Для этого мы подключим самый популярный инструмент для быстрой верстки адаптивных сайтов — Bootstrap 4. Подключение происходит при помощи диспетчера пакетов NuGet.

После подключения нам необходимо сверстать основной макет приложения. По умолчанию он находится в Views/Shared/\_Layout.cshtml.

В данный макет добавляем (либо редактируем уже имеющиеся) компоненты, такие как меню и футер.

→ В меню добавляем основные страницы нашего приложения.

→ В футер добавляем любую информацию на ваш вкус.

## Шаг 2. Разработка представлений

1. Добавление формы входа в приложение
   Помимо основных полей для ввода логина и пароля, также добавляем возможность пользователю перейти на страницу регистрации, если он ещё не зарегистрирован.

2. Страница регистрации пользователя

3. Страница добавления тега

4. Страница добавления роли
   На текущем этапе мы создадим страницу добавления новой роли пользователя. Обратите внимание на поле ввода описание. Так как в данное поле пользователь может ввести любое количество символов, а не только пару слов, необходимо использовать _HTML_-элемент `text-area`.

5. Страница добавления статьи
   На данном шаге необходимо создать страницу добавления новой статьи. В отличие от предыдущих страниц, здесь у пользователя появится возможность выбора доступных тегов для статьи. Также возможно добавления поля, которое будет содержать краткое содержание вашей статьи.

6. Страница редактирования пользователя
   Редактирование пользователя позволяет добавлять дополнительные роли для пользователя. Изменение ролей доступно только для администратора. Роли, которые являются стандартными, изменять нельзя. Добавления проверки на роль пользователя мы выполним в следующим юните.

7. Страница редактирования тега

8. Страница редактирования роли

9. Страница редактирования статьи

10. Страница отображения всех пользователей
    Показываем всех пользователей. У каждого пользователя отображаем список его текущих ролей. Для отображения пользователя можно использовать компонент `card`. Для отображения роли пользователя отлично подойдет компонент `badge`. Компоненты `card` и `badge` доступны в инструменте _Bootstrap_.

11. Страница отображения всех тегов

12. Страница отображения всех ролей
    Показываем все роли в приложении. Также по аналогии с предыдущими страницами.

13. Страница отображения всех статей
    Добавляем страницу отображения всех статей. Обязательно отображаем все теги для каждой статьи. Дополнительно можно отображать информацию о количестве просмотров статьи.

    По желанию на данной странице можно добавить отображение возможных действий, если страницу просматривает пользователь с расширенными возможностями, например Администратор или Модератор.
    Страница просмотра статьи

14. Страница просмотра пользователя, страница просмотра тега и роли
    Здесь воля даётся вашей фантазии, и только вы решаете, как будут выглядеть данные страницы. По желанию можно добавить отображение в «Информации о пользователе» его статей и комментариев.

## Шаг 3. Добавление системных страниц с ошибками

→ Добавляем страницу с ошибкой «Доступ запрещен» на случай, если пользователь пытается обратиться к маршруту, требующему повышенных прав пользователя.

→ Также добавляем страницу с ошибкой «Ресурс не найден», если пользователь обращается по маршруту, которого не существует.

→ Далее добавляем страницу с текстом «Что-то пошло не так».

## Шаг 4. Добавление условий в представления для аутентифицированных пользователей

В нашем макете в меню есть кнопка «Вход». Если пользователь выполняет вход, то данная кнопка меняется на кнопку «Выйти». Для того чтобы отображать необходимую кнопку в зависимости от того, выполнил ли пользователь аутентификацию, необходимо добавить соответствующую проверку в представление.

Данная проверка выполняется при помощи системного класса User — @if (User.Identity.IsAuthenticated):

```cs
@if(User.Identity.IsAuthenticated)
{
  //отображаем кнопку выхода
}
else
{
  // отображаем кнопку входа
}
```

На случай, если мы хотим отображать необходимые элементы только для администратора, также используем системный User и его метод IsInRole — @if (User.IsInRole("Администратор")):

```cs
@if(User.IsInRole("Администратор"))
{
  // отображаем элементы, доступные только администратору
}
```

По аналогии с кнопкой «Вход» добавляем проверку на остальные участки наших представлений. Например, можно добавить условие на отображение в меню ссылок на страницу ролей, комментариев, пользователей только для администратора.

:arrow_up: [к содержанию](readme.md#Содержание)

---

# Этап 3

---

## Шаг 1. Валидация

Во всех представлениях, в которых пользователь можно вводить данные, обязательно добавляем валидацию введенных значений.

## Шаг 2. Протоколирование

Любое действие пользователя в нашем приложении обязательно должно быть сохранено, как минимум, в текстовый файл. Аналогично и с ошибками в нашем приложении.

Для реализации данной функциональности используем библиотеку **NLog**.

## Шаг 3. Глобальный обработчик исключений

Необходимо добавить глобальный обработчик исключений. В случае непредвиденной ошибки пользователь должен перенаправляться на страницу «Что-то пошло не так».

:arrow_up: [к содержанию](readme.md#Содержание)

---

# Этап 4

---

## Шаг 1. Добавление нового проекта в решение

Добавить новый проект с шаблоном веб-API ASP.NET CORE в решение

## Шаг 2. Концепция REST и добавление контроллеров

- Добавить контроллеры для бизнес моделей (пользователь, статья и т.д.)
- В контроллеры добавить основные операции с бизнес-моделями
- При помощи _DI_ внедрить в контроллеры соответствующие и уже реализованные ранее сервисы для работы с бизнес моделями (_UserService_, _PostService_ и т.д.)

## Шаг 3. Документация API

Добавить документацию _API_ при помощи _Swagger_

:arrow_up: [к содержанию](readme.md#Содержание)
